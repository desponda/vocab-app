{{- if .Values.secrets.createFromHelm }}
---
# WARNING: This secret is created from Helm values
# Only use for local development. Production should use external secret management.
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.secrets.externalSecretName }}
  labels:
    {{- include "vocab-app.labels" . | nindent 4 }}
    app.kubernetes.io/component: secrets
type: Opaque
stringData:
  postgres-password: {{ .Values.secrets.postgresPassword | quote }}
  database-url: {{ printf "postgresql://%s:%s@%s-postgres:%d/%s" (index .Values.postgres.env 1).value (.Values.secrets.postgresPassword | urlquery) (include "vocab-app.fullname" .) (.Values.postgres.service.port | int) (index .Values.postgres.env 0).value | quote }}
  jwt-access-secret: {{ .Values.secrets.jwtAccessSecret | quote }}
  jwt-refresh-secret: {{ .Values.secrets.jwtRefreshSecret | quote }}
  {{- if .Values.secrets.anthropicApiKey }}
  anthropic-api-key: {{ .Values.secrets.anthropicApiKey | quote }}
  {{- end }}
{{- else }}
---
# Secrets are managed externally (not created by Helm)
# Expected secret name: {{ .Values.secrets.externalSecretName }}
# Required keys: postgres-password, database-url, jwt-access-secret, jwt-refresh-secret
# Create using: k8s/scripts/create-secrets.sh
{{- end }}
