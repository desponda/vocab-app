{{- if .Values.secrets.database.createFromHelm }}
---
# Database Secret - Created from Helm values (local development only)
# WARNING: This secret is created from Helm values
# Only use for local development. Production should use external secret management.
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.secrets.database.secretName }}
  labels:
    {{- include "vocab-app.labels" . | nindent 4 }}
    app.kubernetes.io/component: database-secret
type: Opaque
stringData:
  postgres-password: {{ .Values.secrets.database.postgresPassword | quote }}
  database-url: {{ printf "postgresql://%s:%s@%s-postgres:%d/%s" (index .Values.postgres.env 1).value (.Values.secrets.database.postgresPassword | urlquery) (include "vocab-app.fullname" .) (.Values.postgres.service.port | int) (index .Values.postgres.env 0).value | quote }}
{{- else }}
---
# Database Secret - Managed externally
# Expected secret name: {{ .Values.secrets.database.secretName }}
# Required keys: postgres-password, database-url
# Create using: database-secret-generator-job.yaml (auto-runs on helm install/upgrade)
# Or manually: kubectl create secret generic {{ .Values.secrets.database.secretName }} \
#                  --from-literal=postgres-password=<password> \
#                  --from-literal=database-url=<url>
{{- end }}
